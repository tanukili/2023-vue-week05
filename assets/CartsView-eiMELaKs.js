import{e as I,f,m as P,g as L,_ as B,o,c as i,d as t,a as u,w as y,t as d,n as v,b as $,h as g,r as b,F as w,i as M,j as S,T as O,L as x,M as V}from"./index-mAOIyDQr.js";const A="https://ec-course-api.hexschool.io/v2",k="2023-vue",C=I("cartStore",{state:()=>({carts:[],finalTotal:0,inputIsAble:!1,isAddingToCart:!1,isDelingFromCart:!1}),getters:{},actions:{getCarts(){f.get(`${A}/api/${k}/cart`).then(s=>{this.carts=s.data.data.carts,this.finalTotal=s.data.data.final_total}).catch(s=>{alert(s.response.data.message)})},addToCart(s,a=1,r=null){this.isAddingToCart=!0;const h={data:{product_id:s,qty:a}};f.post(`${A}/api/${k}/cart`,h).then(l=>{alert(l.data.message),this.isAddingToCart=!1,this.getCarts(),r&&r.hide()}).catch(l=>{alert(l.response.data.message),this.isAddingToCart=!1})},delFromCart(s){this.isDelingFromCart=!0,f.delete(`${A}/api/${k}/cart/${s}`).then(a=>{this.isDelingFromCart=!1,this.getCarts(),alert(a.data.message)}).catch(a=>{alert(`無法刪除單品：${a.response.data.message}`),this.isDelingFromCart=!1})},delAllCarts(){this.isDelingFromCart=!0,f.delete(`${A}/api/${k}/carts`).then(s=>{this.isDelingFromCart=!1,this.getCarts(),alert(s.data.message)}).catch(s=>{this.isDelingFromCart=!1,alert(`無法清除商品：${s.response.data.message}`)})},editCart(s,a,r){this.inputIsAble=!0;const h={data:{product_id:a,qty:r}};f.put(`${A}/api/${k}/cart/${s}`,h).then(l=>{this.getCarts(),alert(l.data.message),this.inputIsAble=!1}).catch(l=>{alert(`無法修改購物車：${l.response.data.message}`),this.inputIsAble=!1})}}}),N="https://ec-course-api.hexschool.io/v2",j="2023-vue",q={data(){return{isAddingOrder:!1}},methods:{...P(C,["getCarts"]),checkoutOrder(s,a){this.isAddingOrder=!0;const{name:r,email:h,tel:l,address:m,message:e}=s,c={data:{user:{name:r,email:h,tel:l,address:m},message:e}};this.carts.length?this.axios.post(`${N}/api/${j}/order`,c).then(n=>{this.isAddingOrder=!1,alert(`${n.data.message}，訂單編號為「${n.data.orderId}」`),a.resetForm(),this.getCarts()}).catch(n=>{alert(n.response.data.message)}):(this.isAddingOrder=!1,alert("目前購物車沒有東西"),window.scrollTo({top:50,behavior:"smooth"}))}},computed:{...L(C,["carts"])}},E={class:"container py-5"},Q=t("h2",{class:"mb-3 text-center"},"填寫訂單資料",-1),U={class:"row justify-content-center"},z={class:"col-10 col-md-8 col-lg-6"},G={class:"mb-3"},H={class:"d-flex justify-content-between"},J=t("label",{for:"email",class:"form-label"},"信箱",-1),K={class:"small text-danger"},R={class:"mb-3"},W={class:"d-flex justify-content-between"},X=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),Y={class:"small text-danger"},Z={class:"mb-3"},tt={class:"d-flex justify-content-between"},st=t("label",{for:"phone",class:"form-label"},"收件人電話",-1),et={class:"small text-danger"},at={class:"mb-3"},ot={class:"d-flex justify-content-between"},nt=t("label",{for:"address",class:"form-label"},"收件人地址",-1),lt={class:"small text-danger"},it={class:"mb-3"},dt=t("label",{for:"message",class:"form-label"},"留言",-1),rt={type:"submit",class:"btn btn-primary w-75 align-self-center"},ct={key:0,class:"spinner-border spinner-border-sm",role:"status"};function ut(s,a,r,h,l,m){const e=b("ErrorMessage"),c=b("VField"),n=b("VForm");return o(),i("div",E,[Q,t("div",U,[t("div",z,[u(n,{onSubmit:m.checkoutOrder,class:"d-flex flex-column"},{default:y(({errors:p})=>[t("div",G,[t("span",H,[J,u(e,{name:"email",class:"invalid-feedback"},{default:y(({message:_})=>[t("span",K,d(_.replace("email","信箱")),1)]),_:1})]),u(c,{id:"email",name:"email",type:"email",class:v(["form-control",{"is-invalid":p.email}]),placeholder:"請輸入信箱",rules:"email|required"},null,8,["class"])]),t("div",R,[t("span",W,[X,u(e,{name:"name",class:"invalid-feedback"},{default:y(({message:_})=>[t("span",Y,d(_.replace("name","姓名")),1)]),_:1})]),u(c,{id:"name",name:"name",type:"text",class:v(["form-control",{"is-invalid":p.name}]),placeholder:"請輸入收件人姓名",rules:"required"},null,8,["class"])]),t("div",Z,[t("span",tt,[st,u(e,{name:"tel",class:"invalid-feedback"},{default:y(({message:_})=>[t("span",et,d(_.replace("tel","電話")),1)]),_:1})]),u(c,{id:"phone",name:"tel",type:"tel",class:v(["form-control",{"is-invalid":p.tel}]),placeholder:"請輸入 09 開頭的手機號碼",rules:{required:!0,regex:/^09\d{8}$/}},null,8,["class"])]),t("div",at,[t("span",ot,[nt,u(e,{name:"address",class:"invalid-feedback"},{default:y(({message:_})=>[t("span",lt,d(_.replace("address","地址")),1)]),_:1})]),u(c,{id:"address",name:"address",type:"text",class:v(["form-control",{"is-invalid":p.address}]),placeholder:"請輸入收件人地址",rules:"required"},null,8,["class"])]),t("div",it,[dt,u(c,{id:"message",name:"message",as:"textarea",class:"form-control",style:{height:"96px"},placeholder:"請輸入留言"})]),t("button",rt,[$(" 送出訂單 "),l.isAddingOrder?(o(),i("span",ct)):g("",!0)])]),_:1},8,["onSubmit"])])])])}const ht=B(q,[["render",ut]]),pt={data(){return{cartsInput:[],loadingBtn:""}},methods:{...P(C,["getCarts","delFromCart","delAllCarts","editCart"]),checkQty(s,a,r){const h=Number.parseInt(this.$refs.cartInput[s].value,10);h>=1?this.editCart(a,r,h):(alert("修改數量必須大於 1"),this.$refs.cartInput[s].value=this.carts[s].qty)},teleportLoading(s){this.loadingBtn=`#${s}`,console.log(this.loadingBtn)}},mounted(){this.getCarts()},computed:{...L(C,["carts","finalTotal","inputIsAble","isDelingFromCart"]),isOnSale(){return this.carts.map(s=>s.product.origin_price>s.product.price)}}},mt={class:"bg-light"},_t={class:"container text-center py-4"},gt=t("h2",null,"我的購物車",-1),bt={class:"text-end mb-2"},ft={key:0,class:"my-5"},$t={key:1,class:"table table-hover align-middle"},vt=t("thead",null,[t("tr",null,[t("th",{scope:"col",width:"60"}),t("th",{scope:"col"},"品名"),t("th",{scope:"col"},"數量"),t("th",{scope:"col",width:"",class:"text-end"},"單價"),t("th",{scope:"col",width:"100",class:"text-end"},"小計")])],-1),Ct={scope:"row"},yt=["onClick","disabled","id"],At={key:0,class:"bi bi-trash3-fill"},kt={class:"d-flex justify-content-center"},wt={class:"input-group",style:{"max-width":"120px"}},Bt=["onChange","value","disabled"],Pt={class:"input-group-text"},Lt={class:"text-end"},St={class:"mb-0"},Ot={key:0,class:"text-danger fw-bold"},Tt=t("span",{class:"d-none d-md-inline-block badge rounded-pill text-bg-warning fw-normal"},"特價中",-1),Ft={key:1},Dt={class:"text-end"},It={class:"text-end"},Mt=t("td",{colspan:"4",class:"py-3"},"總計",-1),xt=t("span",{class:"spinner-border spinner-border-sm",role:"status"},null,-1);function Vt(s,a,r,h,l,m){return o(),i(w,null,[t("div",mt,[t("div",_t,[gt,t("div",bt,[s.carts.length?(o(),i("button",{key:0,onClick:a[0]||(a[0]=e=>(s.delAllCarts(),m.teleportLoading("delAllBtn"))),type:"button",class:"btn btn-outline-danger btn-sm text-end",id:"delAllBtn"}," 清空購物車 ")):g("",!0)]),s.carts.length?(o(),i("table",$t,[vt,t("tbody",null,[(o(!0),i(w,null,M(s.carts,(e,c)=>(o(),i("tr",{key:e.id},[t("th",Ct,[t("button",{onClick:n=>(s.delFromCart(e.id),m.teleportLoading(`delBtn${e.id}`)),type:"button",class:"btn btn-outline-secondary",disabled:s.isDelingFromCart,id:`delBtn${e.id}`},[l.loadingBtn!==`#delBtn${e.id}`?(o(),i("i",At)):g("",!0)],8,yt)]),t("td",null,d(e.product.title),1),t("td",null,[t("div",kt,[t("div",wt,[t("input",{onChange:n=>m.checkQty(c,e.id,e.product_id),type:"number",min:"1",class:"form-control",value:e.qty,ref_for:!0,ref:"cartInput",disabled:s.inputIsAble},null,40,Bt),t("span",Pt,d(e.product.unit),1)])])]),t("td",Lt,[t("p",St,[m.isOnSale[c]?(o(),i("span",Ot,[Tt,$(" "+d(e.product.price),1)])):(o(),i("span",Ft,d(e.product.origin_price),1))])]),t("td",Dt,d(e.total),1)]))),128))]),t("tfoot",It,[t("tr",null,[Mt,t("td",null,d(s.finalTotal),1)])])])):(o(),i("p",ft,"目前購物車沒有商品喔！"))])]),s.isDelingFromCart?(o(),S(O,{key:0,to:l.loadingBtn},[xt],8,["to"])):g("",!0)],64)}const Nt=B(pt,[["render",Vt]]),jt={props:["activedBtn"]},qt=t("span",{class:"spinner-border spinner-border-sm",role:"status"},null,-1),Et=t("span",{class:"spinner-border spinner-border-sm",role:"status"},null,-1);function Qt(s,a,r,h,l,m){return o(),i(w,null,[(o(),S(O,{to:`#showDetailBtn${r.activedBtn}`},[qt],8,["to"])),(o(),S(O,{to:`#addToCartBtn${r.activedBtn}`},[Et],8,["to"]))],64)}const Ut=B(jt,[["render",Qt]]),T="https://ec-course-api.hexschool.io/v2",F="2023-vue",D=I("productsStore",{state:()=>({products:[],singleProduct:{},isLoading:!1,loadingContainer:{}}),getters:{isOnSale(){return this.singleProduct.origin_price>this.singleProduct.price},isOnSaleArr(){return this.products.map(s=>s.origin_price>s.price)}},actions:{getAllProducrs(){f.get(`${T}/api/${F}/products/all`).then(s=>{this.products=s.data.products}).catch(s=>{alert(`無法取得商品資料：${s.response.data.message}`)})},getSingleProduct(s){this.isLoading=!0,f.get(`${T}/api/${F}/product/${s}`).then(a=>{this.singleProduct=a.data.product,this.isLoading=!1}).catch(a=>{alert(`無法取得該商品資料：${a.response.data.message}`),this.isLoading=!1})}}}),zt={components:{Loading:x,ProductBtnsLoading:Ut},data(){return{modal:null,activedBtn:null}},methods:{...P(D,["getAllProducrs","getSingleProduct"]),...P(C,["addToCart"])},computed:{...L(D,["products","singleProduct","isLoading","isOnSale","isOnSaleArr","loadingContainer"]),...L(C,["isAddingToCart"]),modalPorductNum(){return Number.parseInt(this.$refs.productModalinput.value,10)}},mounted(){this.getAllProducrs(),this.modal=new V(this.$refs.productModal),this.$refs.productModal.addEventListener("shown.bs.modal",()=>{this.$refs.productModalinput.value=1})},unmounted(){this.modal.dispose()}},Gt={class:"container"},Ht={class:"table text-center"},Jt=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"產品預覽"),t("th",{scope:"col"},"產品名稱"),t("th",{scope:"col",class:"text-end"},"價格"),t("th",{scope:"col",width:"200"})])],-1),Kt={scope:"row"},Rt=["src","alt"],Wt={class:"fs-6"},Xt=["onClick","disabled","id"],Yt={class:"text-end"},Zt={key:0,class:"mb-0"},ts={class:"text-danger fw-bold"},ss=["onClick","disabled","id"],es={ref:"productModal",class:"modal fade",id:"productModal",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},as={class:"modal-dialog"},os={class:"modal-content vl-parent"},ns={class:"modal-header py-2 bg-info bg-opacity-50"},ls={class:"modal-title fw-bold"},is={class:"modal-body vl-hide"},ds={class:"container-fluid"},rs={class:"row"},cs={class:"col"},us=["src","alt"],hs={class:"col d-flex flex-column py-2"},ps={class:"badge rounded-pill bg-primary align-self-start"},ms={class:"mt-3"},_s={class:"text-end mt-auto"},gs={key:0,class:"mb-0"},bs={class:"text-danger fw-bold"},fs={class:"modal-footer"},$s=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 關閉 ",-1),vs={class:"input-group",style:{width:"40%"}},Cs={type:"number",min:"1",value:"1",class:"form-control",ref:"productModalinput"},ys={key:0,class:"spinner-border spinner-border-sm",role:"status"};function As(s,a,r,h,l,m){const e=b("ProductBtnsLoading"),c=b("Loading");return o(),i(w,null,[t("div",Gt,[t("table",Ht,[Jt,t("tbody",null,[(o(!0),i(w,null,M(s.products,(n,p)=>(o(),i("tr",{key:n.id,class:"align-middle"},[t("th",Kt,[t("img",{src:n.imageUrl,alt:n.title,style:{height:"70px",width:"100px"},class:"img-fluid"},null,8,Rt)]),t("td",null,[t("h3",Wt,d(n.title),1),t("button",{type:"button",class:"btn btn-outline-info btn-sm","data-bs-toggle":"modal","data-bs-target":"#productModal",onClick:_=>(s.getSingleProduct(n.id),this.activedBtn=p),disabled:s.isLoading||s.isAddingToCart,id:`showDetailBtn${p}`}," 產品資訊 ",8,Xt)]),t("td",Yt,[t("p",{class:v(["mb-0",{"text-secondary":s.isOnSaleArr[p],"text-decoration-line-through":s.isOnSaleArr[p],small:s.isOnSaleArr[p]}])}," 定價 "+d(n.origin_price)+" 元 ",3),s.isOnSaleArr[p]?(o(),i("p",Zt,[$(" 現在只要 "),t("span",ts,d(n.price),1),$(" 元 ")])):g("",!0)]),t("td",null,[t("button",{onClick:_=>(s.addToCart(n.id),this.activedBtn=p),type:"button",class:"btn btn-primary btn-sm",disabled:s.isLoading||s.isAddingToCart,id:`addToCartBtn${p}`}," 加入購物車 ",8,ss)])]))),128))]),s.isLoading||s.isAddingToCart?(o(),S(e,{key:0,activedBtn:l.activedBtn},null,8,["activedBtn"])):g("",!0)])]),t("div",es,[t("div",as,[u(c,{active:s.isLoading,"is-full-page":!1},null,8,["active"]),t("div",os,[t("div",ns,[t("h5",ls,d(s.singleProduct.title),1)]),t("div",is,[t("div",ds,[t("div",rs,[t("div",cs,[t("img",{src:s.singleProduct.imageUrl,alt:s.singleProduct.title,class:"img-fluid w-100",style:{height:"240px"}},null,8,us)]),t("div",hs,[t("span",ps,d(s.singleProduct.category),1),t("p",ms,d(s.singleProduct.description),1),t("p",null,d(s.singleProduct.content),1),t("div",_s,[t("p",{class:v(["mb-1",{"text-secondary":s.isOnSale,"text-decoration-line-through":s.isOnSale,small:s.isOnSale}])}," 定價 "+d(s.singleProduct.origin_price)+" 元 ",3),s.isOnSale?(o(),i("p",gs,[$(" 現在只要 "),t("span",bs,d(s.singleProduct.price),1),$(" 元 ")])):g("",!0)])])])])]),t("div",fs,[$s,t("div",vs,[t("input",Cs,null,512),t("button",{onClick:a[0]||(a[0]=n=>s.addToCart(s.singleProduct.id,m.modalPorductNum,l.modal)),class:"btn btn-primary",type:"button"},[$(" 加入購物車 "),s.isAddingToCart?(o(),i("span",ys)):g("",!0)])])])])])],512)],64)}const ks=B(zt,[["render",As]]),ws={components:{OrderForm:ht,CartsList:Nt,ProductsList:ks},mounted(){const s=this.$loading.show({container:this.fullPage});setTimeout(()=>{s.hide()},1e3)}},Bs={class:"vl-parent",ref:"loadingContainer"};function Ps(s,a,r,h,l,m){const e=b("ProductsList"),c=b("CartsList"),n=b("OrderForm");return o(),i("div",Bs,[u(e),u(c),u(n)],512)}const Ss=B(ws,[["render",Ps]]);export{Ss as default};
